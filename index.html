<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-bg: #FAFAF5;
            --color-text: #333333;
            --color-text-light: #666666;
            --color-primary: #2E7D32;
            --color-danger: #D32F2F;
            --color-info: #0288D1;
            --color-card-bg: #FFFFFF;
            --color-border: #E0E0E0;
            --color-success-light: #E8F5E9;
            --color-input-bg: #FAFAFA;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
        }

        body {
            font-family: 'Sarabun', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            font-size: 16px;
            line-height: 1.6;
            padding: 0;
            margin: 0;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px;
        }

        /* ===== Header ===== */
        .header {
            text-align: center;
            margin-bottom: 24px;
            padding: 16px;
            background: linear-gradient(135deg, #2E7D32 0%, #1B5E20 100%);
            color: #FFFFFF;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        /* ===== Dashboard Summary ===== */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 24px;
        }

        .summary-box {
            background: var(--color-card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border-left: 5px solid var(--color-primary);
        }

        .summary-box.danger {
            border-left-color: var(--color-danger);
        }

        .summary-label {
            font-size: 14px;
            color: var(--color-text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .summary-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--color-primary);
        }

        .summary-box.danger .summary-value {
            color: var(--color-danger);
        }

        /* ===== Form Section ===== */
        .form-section {
            background: var(--color-card-bg);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .form-section h2 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--color-text);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--color-text);
        }

        .form-input, .form-select {
            width: 100%;
            padding: 14px;
            font-size: 16px;
            border: 2px solid var(--color-border);
            border-radius: 8px;
            background-color: var(--color-input-bg);
            color: var(--color-text);
            font-family: 'Sarabun', sans-serif;
            transition: border-color 0.3s;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
        }

        .form-input::placeholder {
            color: var(--color-text-light);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
        }

        /* ===== Buttons ===== */
        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 20px;
        }

        .btn {
            padding: 16px 20px;
            font-size: 18px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Sarabun', sans-serif;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background-color: var(--color-primary);
            color: #FFFFFF;
            grid-column: 1 / -1;
        }

        .btn-primary:hover {
            background-color: #1B5E20;
        }

        .btn-reset {
            background-color: #9E9E9E;
            color: #FFFFFF;
        }

        .btn-reset:hover {
            background-color: #757575;
        }

        /* ===== Items List ===== */
        .items-section {
            margin-bottom: 24px;
        }

        .items-section h2 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--color-text);
        }

        .items-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
        }

        .item-card {
            background: var(--color-card-bg);
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border-top: 4px solid var(--color-primary);
            transition: all 0.3s;
        }

        .item-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }

        .item-card.completed {
            border-top-color: #4CAF50;
            background: var(--color-success-light);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .item-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--color-text);
            flex: 1;
        }

        .item-bank {
            display: inline-block;
            background-color: var(--color-info);
            color: #FFFFFF;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .item-status {
            display: inline-block;
            background-color: #4CAF50;
            color: #FFFFFF;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
        }

        .item-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }

        .detail-item {
            background-color: var(--color-input-bg);
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid var(--color-primary);
        }

        .detail-label {
            font-size: 12px;
            color: var(--color-text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .detail-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--color-text);
        }

        .detail-highlight {
            border-left-color: #FF9800;
        }

        .detail-highlight .detail-value {
            color: #FF9800;
        }

        .item-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .btn-pay {
            background-color: #2E7D32;
            color: #FFFFFF;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            min-height: 45px;
            font-family: 'Sarabun', sans-serif;
            transition: all 0.3s;
        }

        .btn-pay:hover {
            background-color: #1B5E20;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(46, 125, 50, 0.3);
        }

        .btn-pay:disabled {
            background-color: #CCCCCC;
            cursor: not-allowed;
            transform: none;
        }

        .btn-delete {
            background-color: #D32F2F;
            color: #FFFFFF;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            min-height: 45px;
            font-family: 'Sarabun', sans-serif;
            transition: all 0.3s;
        }

        .btn-delete:hover {
            background-color: #B71C1C;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(211, 47, 47, 0.3);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--color-text-light);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .empty-state p {
            font-size: 16px;
            margin: 0;
        }

        /* ===== Responsive Design ===== */
        @media (min-width: 768px) {
            .container {
                padding: 24px;
            }

            .header h1 {
                font-size: 32px;
            }

            .dashboard {
                grid-template-columns: 1fr 1fr;
            }

            .summary-value {
                font-size: 42px;
            }

            .form-row {
                grid-template-columns: repeat(2, 1fr);
            }

            .button-group {
                grid-template-columns: auto auto;
                justify-content: flex-end;
            }

            .btn-primary {
                grid-column: auto;
                width: auto;
                padding: 16px 40px;
            }

            .items-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .item-details {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .container {
                padding: 32px;
            }

            .header h1 {
                font-size: 36px;
            }

            .form-row {
                grid-template-columns: repeat(4, 1fr);
            }

            .items-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .item-details {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* ===== Alert Messages ===== */
        .alert {
            padding: 16px;
            margin-bottom: 16px;
            border-radius: 8px;
            display: none;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert.show {
            display: block;
        }

        .alert-success {
            background-color: var(--color-success-light);
            color: #1B5E20;
            border-left: 4px solid #4CAF50;
        }

        .alert-error {
            background-color: #FFEBEE;
            color: #C62828;
            border-left: 4px solid var(--color-danger);
        }

        .alert-loading {
            background-color: #E3F2FD;
            color: var(--color-info);
            border-left: 4px solid var(--color-info);
        }

        /* ===== Loading Spinner ===== */
        .spinner {
            border: 3px solid #F3F3F3;
            border-top: 3px solid var(--color-primary);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üí≥ ‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï ‡∏ú‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞</h1>
            <p>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏ú‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</p>
        </div>

        <!-- Alert -->
        <div id="alert" class="alert"></div>

        <!-- Dashboard -->
        <div class="dashboard">
            <div class="summary-box">
                <div class="summary-label">üí∞ ‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</div>
                <div class="summary-value" id="monthlyPayment">0 ‡∏ö.</div>
            </div>
            <div class="summary-box danger">
                <div class="summary-label">üìä ‡∏´‡∏ô‡∏µ‡πâ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                <div class="summary-value" id="totalDebt">0 ‡∏ö.</div>
            </div>
        </div>

        <!-- Form Section -->
        <div class="form-section">
            <h2>üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡πÉ‡∏´‡∏°‡πà</h2>
            <form id="addForm">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏ô‡πâ‡∏ï‡∏ö‡∏∏‡πä‡∏Å, ‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ)</label>
                        <input type="text" id="itemName" class="form-input" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ö‡∏±‡∏ï‡∏£</label>
                        <select id="bankName" class="form-select" required>
                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ --</option>
                            <option value="‡∏Å‡∏™‡∏¥‡∏Å‡∏£">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏™‡∏¥‡∏Å‡∏£</option>
                            <option value="‡πÑ‡∏ó‡∏¢‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÑ‡∏ó‡∏¢‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå</option>
                            <option value="‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û</option>
                            <option value="‡∏Å‡∏£‡∏∏‡∏á‡πÑ‡∏ó‡∏¢">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏£‡∏∏‡∏á‡πÑ‡∏ó‡∏¢</option>
                            <option value="‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">‡∏ú‡πà‡∏≠‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡∏∞ (‡∏ö‡∏≤‡∏ó)</label>
                        <input type="number" id="monthlyAmount" class="form-input" placeholder="0" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å‡∏Å‡∏µ‡πà‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label>
                        <input type="number" id="months" class="form-input" placeholder="0" required>
                    </div>
                </div>
                <div class="button-group">
                    <button type="reset" class="btn btn-reset">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    <button type="submit" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
                </div>
            </form>
        </div>

        <!-- Items List -->
        <div class="items-section">
            <h2>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
            <div id="itemsList" class="items-grid">
                <div class="empty-state">
                    <div class="empty-state-icon">üì≠</div>
                    <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏¢!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz5iPKAtTFXCAAjLv20f4FlnQXXjncJdYSZg0Tn_6xeCUgB9hmfmoPpufvLt2XaTg/exec';

        // Utility Functions

  const showAlert = (message, type = 'success') => {
    const alertEl = document.getElementById('alert');
    alertEl.className = `alert alert-${type} show`;
    alertEl.textContent = message;
    setTimeout(() => alertEl.classList.remove('show'), 4000);
  };

  const formatCurrency = (amount) => {
    return new Intl.NumberFormat('th-TH', {
      style: 'currency',
      currency: 'THB',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    }).format(Number(amount || 0)).replace('‡∏ø', '').trim() + ' ‡∏ö.';
  };

  const formatDate = (dateStr) => {
    if (!dateStr) return '-';
    const date = new Date(dateStr);
    return date.toLocaleDateString('th-TH', { year: 'numeric', month: 'short', day: 'numeric' });
  };

  const escapeHtml = (text) => {
    const div = document.createElement('div');
    div.textContent = text ?? '';
    return div.innerHTML;
  };

  async function apiGet(action) {
    const url = `${SCRIPT_URL}?action=${encodeURIComponent(action)}`;
    const res = await fetch(url, { method: 'GET' });
    return await res.json();
  }

  async function apiPost(action, payload) {
    const body = new URLSearchParams();
    body.set('action', action);
    Object.entries(payload || {}).forEach(([k, v]) => body.set(k, String(v)));

    const res = await fetch(SCRIPT_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' },
      body
    });

    return await res.json();
  }

  const calculateSummary = (items) => {
    const monthlyPayment = items.reduce((sum, item) => sum + (Number(item.monthlyAmount) || 0), 0);
    const totalDebt = items.reduce((sum, item) => sum + ((Number(item.monthlyAmount) || 0) * (Number(item.months) || 0)), 0);
    document.getElementById('monthlyPayment').textContent = formatCurrency(monthlyPayment);
    document.getElementById('totalDebt').textContent = formatCurrency(totalDebt);
  };

  const renderItems = (items) => {
    const listEl = document.getElementById('itemsList');
    if (!items || items.length === 0) {
      listEl.innerHTML = `
        <div class="empty-state">
          <div class="empty-state-icon">üì≠</div>
          <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏¢!</p>
        </div>`;
      return;
    }

    listEl.innerHTML = items.map((item) => {
      const isCompleted = Number(item.months) === 0;
      const totalDebt = (Number(item.monthlyAmount) || 0) * (Number(item.months) || 0);

      return `
        <div class="item-card ${isCompleted ? 'completed' : ''}">
          <div class="item-header">
            <div class="item-title">${escapeHtml(item.itemName)}</div>
            <div style="display:flex; gap:8px; flex-wrap:wrap;">
              <span class="item-bank">${escapeHtml(item.bankName)}</span>
              ${isCompleted ? '<span class="item-status">‚úì ‡∏ú‡πà‡∏≠‡∏ô‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß</span>' : ''}
            </div>
          </div>

          <div class="item-details">
            <div class="detail-item">
              <div class="detail-label">‡∏ú‡πà‡∏≠‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡∏∞</div>
              <div class="detail-value">${formatCurrency(item.monthlyAmount)}</div>
            </div>
            <div class="detail-item detail-highlight">
              <div class="detail-label">‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å</div>
              <div class="detail-value">${Number(item.months)} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">‡∏´‡∏ô‡∏µ‡πâ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
              <div class="detail-value">${formatCurrency(totalDebt)}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</div>
              <div class="detail-value">${formatDate(item.timestamp)}</div>
            </div>
          </div>

          <div class="item-actions">
            <button class="btn-pay" onclick="payInstallment(${item.rowId})" ${isCompleted ? 'disabled' : ''}>
              ${isCompleted ? '‚úì ‡∏ú‡πà‡∏≠‡∏ô‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß' : '‚úì ‡∏à‡πà‡∏≤‡∏¢‡∏á‡∏ß‡∏î‡∏ô‡∏µ‡πâ'}
            </button>
            <button class="btn-delete" onclick="deleteItem(${item.rowId})">üóë ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
          </div>
        </div>`;
    }).join('');
  };

  async function loadData() {
    try {
      const data = await apiGet('getData');
      if (!data.success) throw new Error(data.message || '‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
      renderItems(data.items);
      calculateSummary(data.items);
    } catch (err) {
      showAlert('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: ' + err.message, 'error');
    }
  }

  document.getElementById('addForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    try {
      const payload = {
        itemName: document.getElementById('itemName').value,
        bankName: document.getElementById('bankName').value,
        monthlyAmount: document.getElementById('monthlyAmount').value,
        months: document.getElementById('months').value
      };
      const res = await apiPost('addData', payload);
      if (!res.success) throw new Error(res.message || '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');

      showAlert('‚úì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
      document.getElementById('addForm').reset();
      await loadData();
    } catch (err) {
      showAlert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: ' + err.message, 'error');
    }
  });

  async function payInstallment(rowId) {
    if (!confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏á‡∏ß‡∏î‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
    try {
      const res = await apiPost('updateData', { rowId });
      if (!res.success) throw new Error(res.message || '‡∏à‡πà‡∏≤‡∏¢‡∏á‡∏ß‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');

      showAlert('‚úì ‡∏à‡πà‡∏≤‡∏¢‡∏á‡∏ß‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
      await loadData();
    } catch (err) {
      showAlert('‡∏à‡πà‡∏≤‡∏¢‡∏á‡∏ß‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: ' + err.message, 'error');
    }
  }

  async function deleteItem(rowId) {
    if (!confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ')) return;
    try {
      const res = await apiPost('deleteData', { rowId });
      if (!res.success) throw new Error(res.message || '‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');

      showAlert('‚úì ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
      await loadData();
    } catch (err) {
      showAlert('‡∏•‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: ' + err.message, 'error');
    }
  }

  window.addEventListener('load', loadData);
</script>
</body>
</html>
